name: Website Builder
on:
  workflow_dispatch:
  push:
    paths:
      - .github/workflows/website-builder.yml
      - new/**
jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Install Node
        run: |
          sudo apt install nodejs
      - name: Build website
        run: |
          pwd
          cd new
          npm install
          npm run build
          cd dist
          rm -f ../../deepracer-console-new.zip && zip -r ../../deepracer-console-new.zip .

      - name: Create a draft release
        run: |
          gh release create --draft --prerelease --title "${{ github.ref_name }} ${{ github.run_id }}" --target ${{ github.ref_name }} --notes "Auto-generated draft release from workflow https://github.com/aws-deepracer-community/deepracer-custom-console/actions/runs/${{ github.run_id }}" v0.${{ github.run_id }}  deepracer-console-new.zip
          rm deepracer-console-new.zip
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
